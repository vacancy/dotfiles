if version > 740
    set termguicolors
endif

set t_8f=[38;2;%lu;%lu;%lum
set t_8b=[48;2;%lu;%lu;%lum

filetype on  " å¼€å¯æ–‡ä»¶ç±»å‹ä¾¦æµ‹
filetype indent on
filetype plugin on  " æ ¹æ®ä¾¦æµ‹åˆ°çš„ä¸åŒç±»å‹åŠ è½½å¯¹åº”çš„æ’ä»¶

" è®©é…ç½®å˜æ›´ç«‹å³ç”Ÿæ•ˆ
" autocmd BufWritePost $MYVIMRC source $MYVIMRC

set viminfo+=n~/.vim/viminfo

set nocompatible          " å…³é—­å…¼å®¹æ¨¡å¼
set number                " å¼€å¯è¡Œå·æ˜¾ç¤º
set nowrap                " ç¦æ­¢æŠ˜è¡Œ
set laststatus=2          " æ€»æ˜¯æ˜¾ç¤ºçŠ¶æ€æ 
set ruler                 " æ˜¾ç¤ºå…‰æ ‡å½“å‰ä½ç½®
set hlsearch              " é«˜äº®æ˜¾ç¤ºæœç´¢ç»“æœ
set incsearch             " å¼€å¯å®æ—¶æœç´¢åŠŸèƒ½
set ignorecase            " æœç´¢æ—¶å¤§å°å†™ä¸æ•æ„Ÿ
set wildmenu              " vim è‡ªèº«å‘½ä»¤è¡Œæ¨¡å¼æ™ºèƒ½è¡¥å…¨

set expandtab             " å°†åˆ¶è¡¨ç¬¦æ‰©å±•ä¸ºç©ºæ ¼
set tabstop=4             " è®¾ç½®ç¼–è¾‘æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set shiftwidth=4          " è®¾ç½®æ ¼å¼åŒ–æ—¶åˆ¶è¡¨ç¬¦å ç”¨ç©ºæ ¼æ•°
set softtabstop=4         " è®© vim æŠŠè¿ç»­æ•°é‡çš„ç©ºæ ¼è§†ä¸ºä¸€ä¸ªåˆ¶è¡¨ç¬¦

set backspace=2
set whichwrap+=<,>,h,l

syntax enable    " å¼€å¯è¯­æ³•é«˜äº®åŠŸèƒ½
syntax on        " å…è®¸ç”¨æŒ‡å®šè¯­æ³•é«˜äº®é…è‰²æ–¹æ¡ˆæ›¿æ¢é»˜è®¤æ–¹æ¡ˆ

set foldmethod=indent     " åŸºäºç¼©è¿›æˆ–è¯­æ³•è¿›è¡Œä»£ç æŠ˜å 
set nofoldenable          " å¯åŠ¨ vim æ—¶å…³é—­æŠ˜å ä»£ç 
" augroup OpenAllFoldsOnFileOpen
"     autocmd!
"     autocmd BufRead * normal zR
" augroup END

set gcr=a:block-blinkon0  " ç¦æ­¢å…‰æ ‡é—ªçƒ
set guioptions-=l         " ç¦æ­¢æ˜¾ç¤ºæ»šåŠ¨æ¡
set guioptions-=L
set guioptions-=r
set guioptions-=R
set guioptions-=m         " ç¦æ­¢æ˜¾ç¤ºèœå•å’Œå·¥å…·æ¡
set guioptions-=T
set guifont=YaHei\ Consolas\ Hybrid\ 10.5

" å®šä¹‰é¼ æ ‡æ¨¡å¼
set mouse=a
set selection=exclusive
set selectmode=mouse,key

" enable the spell check
set spell spelllang=en_us

" å®šä¹‰å¿«æ·é”®çš„å‰ç¼€ï¼Œå³ <leader>
let mapleader=";"

" Slient the warnings on start for YCM.
" if has('python3')
"   silent! python3 1
" endif

" >>>>
" æ’ä»¶å®‰è£…

" vundle ç¯å¢ƒè®¾ç½®
filetype off
set rtp+=~/.vim/bundle/Vundle.vim
" vundle ç®¡ç†çš„æ’ä»¶åˆ—è¡¨å¿…é¡»ä½äº vundle#begin() å’Œ vundle#end() ä¹‹é—´
call vundle#begin()

Plugin 'VundleVim/Vundle.vim'

" Color schemes
Plugin 'altercation/vim-colors-solarized'
Plugin 'tomasr/molokai'
Plugin 'vim-scripts/phd'
Plugin 'iCyMind/NeoSolarized'

" Display
Plugin 'Lokaltog/vim-powerline'
" Indentation guide
Plugin 'nathanaelkane/vim-indent-guides'

" File system
Plugin 'scrooloose/nerdtree'  " File list
Plugin 'fholgado/minibufexpl.vim'
Plugin 'derekwyatt/vim-fswitch'  " Switcher between .h and .cpp
Plugin 'derekwyatt/vim-protodef'  " Converting .h to .cpp
Plugin 'airblade/vim-gitgutter'

" Coding helpers. Highlight, auto-completion, comment, navigation.
Plugin 'octol/vim-cpp-enhanced-highlight'
Plugin 'majutsushi/tagbar'  " Tag list
Plugin 'Valloric/YouCompleteMe'
Plugin 'aperezdc/vim-template'  " File templates
Plugin 'sirver/ultisnips'
Plugin 'honza/vim-snippets' " Snippets collection
Plugin 'scrooloose/nerdcommenter'  " Comment
Plugin 'rizzatti/dash.vim'

" Search and editing
Plugin 'Lokaltog/vim-easymotion'  " Quick cursor jumping
Plugin 'terryma/vim-multiple-cursors'  " Multiple cursor
Plugin 'dyng/ctrlsf.vim'
Plugin 'kshenoy/vim-signature'
Plugin 'vim-scripts/BOOKMARKS--Mark-and-Highlight-Full-Lines'

" Terminal
" Plugin 'ervandew/screen'

Plugin 'vim-scripts/DfrankUtil'
" Plugin 'vim-scripts/indexer.tar.gz'
Plugin 'vim-scripts/vimprj'
Plugin 'vim-scripts/DrawIt'

" æ’ä»¶åˆ—è¡¨ç»“æŸ
call vundle#end()
filetype plugin indent on

" Remove the trailing spaces before saving.
autocmd BufWritePre * %s/\s\+$//e

" MiniBufExplorer
autocmd vimenter * :MBEToggle
" NERDTree
autocmd vimenter * NERDTree
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTreeType") &&b:NERDTreeType == "primary") | q | endif
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif

autocmd VimEnter * nested :TagbarOpen
" wincmd l
autocmd VimEnter * wincmd l
autocmd VimEnter * wincmd j

" é…è‰²æ–¹æ¡ˆ
" Change the color for comments.

colorscheme molokai
set background=dark
hi Comment ctermfg=246 guifg=#999999
hi VisualNOS ctermbg=240
hi Visual ctermbg=238
hi Underlined ctermfg=246 cterm=underline
hi StatusLine   ctermfg=246 ctermbg=253
hi StatusLineNC ctermfg=246 ctermbg=232

" colorscheme NeoSolarized
" set background=light
" let g:neosolarized_contrast = "high"
" let g:neosolarized_visibility = "high"
" let g:gitgutter_override_sign_column_highlight = 0

" é«˜äº®æ˜¾ç¤ºå½“å‰è¡Œ/åˆ—
set cursorline
set cursorcolumn
set colorcolumn=120

" hi Normal guibg=NONE ctermbg=NONE
" hi ColorColumn  term=reverse ctermbg=1 guibg=LightRed
" hi CursorLine   cterm=NONE ctermbg=1 guibg=LightRed
" hi CursorColumn cterm=NONE ctermbg=1 guibg=LightRed

" hi Comment ctermfg=246 guifg=#999999
" hi VisualNOS ctermbg=240
" hi Visual ctermbg=238
" hi Underlined ctermfg=246 cterm=underline
" hi StatusLine   ctermfg=246 ctermbg=253
" hi StatusLineNC ctermfg=246 ctermbg=232

:nnoremap <space> zA

" å®šä¹‰å¿«æ·é”®åˆ°è¡Œé¦–å’Œè¡Œå°¾
nmap LB 0
nmap LE $
" å®šä¹‰å¿«æ·é”®åœ¨ç»“å¯¹ç¬¦ä¹‹é—´è·³è½¬
nmap <leader>M %

vnoremap <leader>y "+y          " è®¾ç½®å¿«æ·é”®å°†é€‰ä¸­æ–‡æœ¬å—å¤åˆ¶è‡³ç³»ç»Ÿå‰ªè´´æ¿
nmap <leader>p "+p              " è®¾ç½®å¿«æ·é”®å°†ç³»ç»Ÿå‰ªè´´æ¿å†…å®¹ç²˜è´´è‡³vim

" ä¿å­˜å¿«æ·é”®
" map <leader>ss :mksession! my.vim<cr> :wviminfo! my.viminfo<cr>
map <leader>ss :mksession! my.vim<cr>
" æ¢å¤å¿«æ·é”®
" map <leader>rs :source my.vim<cr> :rviminfo my.viminfo<cr>
map <leader>rs :source my.vim<cr>

inoremap <C-l> <RIGHT>
inoremap <C-k> <UP>
inoremap <C-j> <DOWN>
inoremap <C-h> <LEFT>

" FSwitch
nmap <silent> <leader>sw :FSHere<cr>
nnoremap <leader>tig <Plug>IndentGuidesToggle
nnoremap <leader>tfl :NERDTreeToggle<CR>
nnoremap <leader>tbl :MBEToggle<cr>
nnoremap <leader>ttl :TagbarToggle<CR>

map <C-l> :MBEbf<cr>
map <C-h> :MBEbb<cr>

nnoremap <C-g> :YcmCompleter GoToDefinitionElseDeclaration<CR>
nnoremap <leader>g :YcmCompleter GoToDefinitionElseDeclaration<CR>
nnoremap <leader>d :YcmCompleter GetDoc<CR>
inoremap <leader>; <C-x><C-o>                                        " YCM é›†æˆ OmniCppComplete è¡¥å…¨å¼•æ“ï¼Œè®¾ç½®å…¶å¿«æ·é”®

" wildfire
" map <SPACE> <Plug>(wildfire-fuel)
" vmap <S-SPACE> <Plug>(wildfire-water)
" let g:wildfire_objects = ["i'", 'i"', "i)", "i]", "i}", "i>", "ip"]  " é€‚ç”¨äºå“ªäº›ç»“å¯¹ç¬¦

map  <leader>s <Plug>(easymotion-bd-f)            " <leader>c{char} to move to {char}
nmap <leader>s <Plug>(easymotion-overwin-f)

map  f <Plug>(easymotion-bd-w)
nmap f <Plug>(easymotion-overwin-w)
nmap s <Plug>(easymotion-overwin-f2)
" map  L <Plug>(easymotion-bd-jk)
" nmap L <Plug>(easymotion-overwin-line)
"
" ä½¿ç”¨ ctrlsf.vim æ’ä»¶åœ¨å·¥ç¨‹å†…å…¨å±€æŸ¥æ‰¾å…‰æ ‡æ‰€åœ¨å…³é”®å­—ï¼Œè®¾ç½®å¿«æ·é”®ã€‚å¿«æ·é”®é€Ÿè®°æ³•ï¼šglobal search
nnoremap <leader>gs :CtrlSF<CR>

" æ­£å‘éå†åŒåæ ‡ç­¾
nmap <leader>tn :tnext<CR>
" åå‘éå†åŒåæ ‡ç­¾
nmap <leader>tp :tprevious<CR>

" å®šä¹‰:Manå‘½ä»¤æŸ¥çœ‹å„ç±»manä¿¡æ¯çš„å¿«æ·é”®
nmap <leader>man :Man 3 <cword><CR>

" è°ƒç”¨ gundo æ ‘
nnoremap <leader>ud :GundoToggle<CR>

" Powerline
let g:Powerline_colorscheme='solarized256'

" Indent Guides
let g:indent_guides_enable_on_vim_startup=1 " éš vim è‡ªå¯åŠ¨
let g:indent_guides_start_level=2           " ä»ç¬¬äºŒå±‚å¼€å§‹å¯è§†åŒ–æ˜¾ç¤ºç¼©è¿›
let g:indent_guides_guide_size=1            " è‰²å—å®½åº¦

" Protodef
let g:disable_protodef_sorting=1  " æˆå‘˜å‡½æ•°çš„å®ç°é¡ºåºä¸å£°æ˜é¡ºåºä¸€è‡´

" è‡ªå®šä¹‰ vim-signature å¿«æ·é”®
let g:SignatureMap = {
    \ 'leader'             :  "m",
    \ 'PlaceNextMark'      :  "m,",
    \ 'ToggleMarkAtLine'   :  "m.",
    \ 'PurgeMarksAtLine'   :  "m-",
    \ 'DeleteMark'         :  "dm",
    \ 'PurgeMarks'         :  "mda",
    \ 'PurgeMarkers'       :  "m<BS>",
    \ 'GotoNextLineAlpha'  :  "']",
    \ 'GotoPrevLineAlpha'  :  "'[",
    \ 'GotoNextSpotAlpha'  :  "`]",
    \ 'GotoPrevSpotAlpha'  :  "`[",
    \ 'GotoNextLineByPos'  :  "]'",
    \ 'GotoPrevLineByPos'  :  "['",
    \ 'GotoNextSpotByPos'  :  "mn",
    \ 'GotoPrevSpotByPos'  :  "mp",
    \ 'GotoNextMarker'     :  "[+",
    \ 'GotoPrevMarker'     :  "[-",
    \ 'GotoNextMarkerAny'  :  "]=",
    \ 'GotoPrevMarkerAny'  :  "[=",
    \ 'ListLocalMarks'     :  "ms",
    \ 'ListLocalMarkers'   :  "m?"
\ }

let NERDTreeWinSize=32             " è®¾ç½® NERDTree å­çª—å£å®½åº¦
let NERDTreeWinPos="left"          " è®¾ç½® NERDTree å­çª—å£ä½ç½®
let NERDTreeShowHidden=1           " æ˜¾ç¤ºéšè—æ–‡ä»¶
let NERDTreeMinimalUI=1            " NERDTree å­çª—å£ä¸­ä¸æ˜¾ç¤ºå†—ä½™å¸®åŠ©ä¿¡æ¯
let NERDTreeAutoDeleteBuffer=1     " åˆ é™¤æ–‡ä»¶æ—¶è‡ªåŠ¨åˆ é™¤æ–‡ä»¶å¯¹åº” buffer
let NERDTreeHighlightCursorline=1  " é«˜äº®æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨çš„æ–‡ä»¶
let NERDTreeChDirMode = 2          " å½“å‰ç›®å½•çš„è®¾å®š

let g:tagbar_autofocus=1
let g:tagbar_vertical = 25 " æ˜¾ç¤ºåœ¨Nerdtreeä¸‹æ–¹
let g:tagbar_width=32      " è®¾ç½®æ ‡ç­¾å­çª—å£çš„å®½åº¦
let g:tagbar_compact=1     " tagbar å­çª—å£ä¸­ä¸æ˜¾ç¤ºå†—ä½™å¸®åŠ©ä¿¡æ¯
" è®¾ç½® ctags å¯¹å“ªäº›ä»£ç æ ‡è¯†ç¬¦ç”Ÿæˆæ ‡ç­¾
let g:tagbar_type_cpp = {
    \ 'ctagstype' : 'c++',
    \ 'kinds'     : [
        \ 'c:classes:0:1',
        \ 'd:macros:0:1',
        \ 'e:enumerators:0:0',
        \ 'f:functions:0:1',
        \ 'g:enumeration:0:1',
        \ 'l:local:0:1',
        \ 'm:members:0:1',
        \ 'n:namespaces:0:1',
        \ 'p:functions_prototypes:0:1',
        \ 's:structs:0:1',
        \ 't:typedefs:0:1',
        \ 'u:unions:0:1',
        \ 'v:global:0:1',
        \ 'x:external:0:1'
    \ ],
    \ 'sro'        : '::',
    \ 'kind2scope' : {
        \ 'g' : 'enum',
        \ 'n' : 'namespace',
        \ 'c' : 'class',
        \ 's' : 'struct',
        \ 'u' : 'union'
    \ },
    \ 'scope2kind' : {
        \ 'enum'      : 'g',
        \ 'namespace' : 'n',
        \ 'class'     : 'c',
        \ 'struct'    : 's',
        \ 'union'     : 'u'
    \ }
\ }
let g:tagbar_autoshowtag = 1  " å½“ç¼–è¾‘ä»£ç æ—¶ï¼Œåœ¨Tagbarè‡ªåŠ¨è¿½è¸ªå˜é‡
let g:tagbar_sort=0           " ä¸æŒ‰ç…§å­—æ¯é¡ºåºæ’åº
let g:tagbar_foldlevel=99     " é»˜è®¤å±•å¼€

" YCM
let g:ycm_global_ycm_extra_conf = '~/.vim/ycm_extra_conf.py'
let g:ycm_complete_in_comments=1                                     " è¡¥å…¨åŠŸèƒ½åœ¨æ³¨é‡Šä¸­åŒæ ·æœ‰æ•ˆ
let g:ycm_confirm_extra_conf=1                                       " å…è®¸ vim åŠ è½½ .ycm_extra_conf.py æ–‡ä»¶ï¼Œä¸å†æç¤º
let g:ycm_collect_identifiers_from_tags_files=0                      " å¼€å¯ YCM æ ‡ç­¾è¡¥å…¨å¼•æ“
let g:ycm_min_num_of_chars_for_completion=1                          " ä»ç¬¬ä¸€ä¸ªé”®å…¥å­—ç¬¦å°±å¼€å§‹ç½—åˆ—åŒ¹é…é¡¹
let g:ycm_cache_omnifunc=1                                           " ç¦æ­¢ç¼“å­˜åŒ¹é…é¡¹ï¼Œæ¯æ¬¡éƒ½é‡æ–°ç”ŸæˆåŒ¹é…é¡¹
let g:ycm_seed_identifiers_with_syntax=1                             " è¯­æ³•å…³é”®å­—è¡¥å…¨
let g:ycm_autoclose_preview_window_after_completion=1
" set completeopt-=preview                                           " è¡¥å…¨å†…å®¹ä¸ä»¥åˆ†å‰²å­çª—å£å½¢å¼å‡ºç°ï¼Œåªæ˜¾ç¤ºè¡¥å…¨åˆ—è¡¨

let g:UltiSnipsExpandTrigger="<c-f>"
let g:UltiSnipsJumpForwardTrigger="<c-n>"
let g:UltiSnipsJumpBackwardTrigger="<c-b>"

let g:ultisnips_python_style="google"
let g:ultisnips_python_quoting_style="single"
let g:ultisnips_python_triple_quoting_style="double"

" NERD commenter
let g:NERDSpaceDelims = 1

" è®¾ç½®æ’ä»¶ indexer è°ƒç”¨ ctags çš„å‚æ•°
" é»˜è®¤ --c++-kinds=+p+lï¼Œé‡æ–°è®¾ç½®ä¸º --c++-kinds=+l+p+x+c+d+e+f+g+m+n+s+t+u+v
" é»˜è®¤ --fields=+iaS ä¸æ»¡è¶³ YCM è¦æ±‚ï¼Œéœ€æ”¹ä¸º --fields=+iaSl
" let g:indexer_ctagsCommandLineOptions="--c++-kinds=+l+p+x+c+d+e+f+g+m+n+s+t+u+v --fields=+iaSl --extra=+q"

let g:ctrlsf_default_view_mode = 'compact'
let g:ctrlsf_position = 'bottom'

" å¿«æ·æ›¿æ¢
let g:multi_cursor_start_word_key='<C-d>'
let g:multi_cursor_next_key='<C-d>'
highlight multiple_cursors_cursor term=reverse cterm=reverse gui=reverse
highlight link multiple_cursors_visual Visual
autocmd bufenter * if (winnr("$") == 1 && exists("b:NERDTree") && b:NERDTree.isTabTree()) | q | endif

" å¯ç”¨:Manå‘½ä»¤æŸ¥çœ‹å„ç±»manä¿¡æ¯
source $VIMRUNTIME/ftplugin/man.vim

" Disable the undo history
" set undodir=~/.vim/undo_history/  " ä¿å­˜ undo å†å²ã€‚å¿…é¡»å…ˆè¡Œåˆ›å»º .undo_history/
" set undofile
" è®¾ç½®ç¯å¢ƒä¿å­˜é¡¹
set sessionoptions="blank,globals,localoptions,tabpages,sesdir,folds,help,options,resize,winpos,winsize"

" Templates
let g:templates_directory='$HOME/.vim/templates'
let g:username='Jiayuan Mao'
let g:email='maojiayuan@gmail.com'

" Snippets
let g:snips_author="Jiayuan Mao"
let g:snips_email="maojiayuan@gmail.com"
let g:snips_github="https://github.com/vacancy"

" nmap <leader>q :q<CR>           " å®šä¹‰å¿«æ·é”®å…³é—­å½“å‰åˆ†å‰²çª—å£
" nmap <leader>w :w<CR>           " å®šä¹‰å¿«æ·é”®ä¿å­˜å½“å‰çª—å£å†…å®¹
" nmap <leader>WQ :wa<CR>:q<CR>   " å®šä¹‰å¿«æ·é”®ä¿å­˜æ‰€æœ‰çª—å£å†…å®¹å¹¶é€€å‡º vim
" nmap <leader>Q :qa!<CR>         " ä¸åšä»»ä½•ä¿å­˜ï¼Œç›´æ¥é€€å‡º vim

" è®¾ç½®å¿«æ·é”®éå†å­çª—å£
" nnoremap nw <C-W><C-W>      " ä¾æ¬¡éå†
" nnoremap <leader>lw <C-W>l  " è·³è½¬è‡³å³æ–¹çš„çª—å£
" nnoremap <leader>hw <C-W>h  " è·³è½¬è‡³å·¦æ–¹çš„çª—å£
" nnoremap <leader>kw <C-W>k  " è·³è½¬è‡³ä¸Šæ–¹çš„å­çª—å£
" nnoremap <leader>jw <C-W>j  " è·³è½¬è‡³ä¸‹æ–¹çš„å­çª—å£

" ç²¾å‡†æ›¿æ¢
" æ›¿æ¢å‡½æ•°ã€‚å‚æ•°è¯´æ˜ï¼š
" confirmï¼šæ˜¯å¦æ›¿æ¢å‰é€ä¸€ç¡®è®¤
" wholewordï¼šæ˜¯å¦æ•´è¯åŒ¹é…
" replaceï¼šè¢«æ›¿æ¢å­—ç¬¦ä¸²
function! Replace(confirm, wholeword, replace)
    wa
    let flag = ''
    if a:confirm
        let flag .= 'gec'
    else
        let flag .= 'ge'
    endif
    let search = ''
    if a:wholeword
        let search .= '\<' . escape(expand('<cword>'), '/\.*$^~[') . '\>'
    else
        let search .= expand('<cword>')
    endif
    let replace = escape(a:replace, '/\&~')
    execute 'argdo %s/' . search . '/' . replace . '/' . flag . '| update'
endfunction

" ä¸ç¡®è®¤ã€éæ•´è¯
nnoremap <leader>R :call Replace(0, 0, input('Replace '.expand('<cword>').' with: '))<CR>
" ä¸ç¡®è®¤ã€æ•´è¯
nnoremap <leader>rw :call Replace(0, 1, input('Replace '.expand('<cword>').' with: '))<CR>
" ç¡®è®¤ã€éæ•´è¯
nnoremap <leader>rc :call Replace(1, 0, input('Replace '.expand('<cword>').' with: '))<CR>
" ç¡®è®¤ã€æ•´è¯
nnoremap <leader>rcw :call Replace(1, 1, input('Replace '.expand('<cword>').' with: '))<CR>
nnoremap <leader>rwc :call Replace(1, 1, input('Replace '.expand('<cword>').' with: '))<CR>

